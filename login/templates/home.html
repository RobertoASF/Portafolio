<!DOCTYPE html>
{% load static %}
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Document</title>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <!--Boostrap-->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous" />
  <!--Tipografía Google-->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;0,800;1,300;1,400;1,500;1,600;1,700;1,800&display=swap"
    rel="stylesheet" />

    
    
</head>

<body style="font-family: 'Open Sans', sans-serif">
  <nav class="navbar bg-body-tertiary">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-fire"
          viewBox="0 0 16 16">
          <path
            d="M8 16c3.314 0 6-2 6-5.5 0-1.5-.5-4-2.5-6 .25 1.5-1.25 2-1.25 2C11 4 9 .5 6 0c.357 2 .5 4-2 6-1.25 1-2 2.729-2 4.5C2 14 4.686 16 8 16Zm0-1c-1.657 0-3-1-3-2.75 0-.75.25-2 1.25-3C6.125 10 7 10.5 7 10.5c-.375-1.25.5-3.25 2-3.5-.179 1-.25 2 1 3 .625.5 1 1.364 1 2.25C11 14 9.657 15 8 15Z" />
        </svg>
        TindPlace
      </a>
      <a href="{% url 'login' %}">Iniciar sesión</a>
      <a href="{% url 'register' %}">Registrarse</a>
      {% if request.session.user_id %}
      <a href="{% url 'evaluation' %}">Evaluacion</a>
      <a href="{% url 'create_product' %}">Publicar</a>
      <a href="{% url 'logout' %}">Cerrar sesión</a>
      {% endif %}
    </div>
  </nav>
  <div style="
        display: flex;
        align-items: center;
        flex-direction: column;
        margin-top: 40px;
      ">
    {% if user is not None %}
    <h1>¡Bienvenido! {{ user.user_name1 }}</h1>
    {% if message %}
    <div class="alert alert-light">{{ message }}</div>
    {% endif %} {% else %}
    <h1>Bienvenido!</h1>
    <p>No se pudo comprobar si hay un usuario registrado</p>
    {% endif %}
  </div>


  {% if request.session.user_id %}
  <div class="container text-center">
    <div class="row">
      <div class="col align-self-center mt-5">
        <div class="btn-group " role="group" aria-label="Default button group">
          <a type="button" class="btn btn-outline-primary" href="{% url 'home' %}">Tus preferencias</a>
          <a type="button" class="btn btn-outline-primary" href="{% url 'all_products' %}">Todos los productos</a>
        </div>
      </div>
    </div>
  </div>
  {% endif %}




  <div class="container my-4">
    <div class="row" id="products-container">
      {% for product in products %}
      <div class="col-4 my-2 {% if forloop.counter > 3 %}hidden{% endif %}">
        <div class="card">
          <img class="card-img-top" src="https://placehold.co/300x300/png" alt="Card image cap">
          <div class="card-body">
            <h3 class="card-title">{{ product.prod_name }}</h3>
            <p>Precio: $ {{ product.prod_price }}</p>
            <p>Descripción: {{ product.prod_description }}</p>
            <p>Vendedor: {{ product.prod_seller.user_name1 }} {{ product.prod_seller.user_surname1 }}</p>
            {% if product.prod_new %}
            <p>Condición: <span class="badge text-bg-primary">Nuevo</span></p>
            {% else %}
            <p>Condición: <span class="badge text-bg-warning">Usado</span></p>
            {% endif %}
            <div class="row">
              <div class="col">
                <b>Publicado en: <br> {{ product.prod_date }}</b>
              </div>
              <div class="col d-flex justify-content-center align-items-center">
                {% if request.session.user_id %}
                <a class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#productModal"
                  data-prod-id="{{ product.prod_id }}" role="button"> Comprar </a>
                {% else %}
                <a class="btn btn-primary btn-sm " href="#" role="button"> Registrate para comprar </a>
                {% endif %}
              </div>
            </div>
          </div>
        </div>

      </div>
      {% endfor %}

      <div class="modal fade" id="productModal" tabindex="-1" aria-labelledby="productModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="productModalLabel">Detalles del producto</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="productModalBody">
              <!-- Los detalles del producto se cargarán aquí -->
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
              <button type="button" class="btn btn-primary">Comprar</button>
            </div>
          </div>
        </div>
      </div>


      <div class="container text-center">
        <div class="row">
          <div class="col align-self-center mt-5">
            <div class="btn-group " role="group" aria-label="Default button group">
              <button id="load-more-btn" class="btn btn-primary">Cargar más productos</button>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>


  <footer
    style="position: fixed; bottom: 0; left: 0; width: 100%; background-color: rgb(186, 12, 134); color: rgb(245, 248, 251);">
    <div class="container">
      <div id="weather-widget"></div>
      <script>
        function getWeatherByLocation() {
          navigator.geolocation.getCurrentPosition(function (position) {
            var lat = position.coords.latitude;
            var lon = position.coords.longitude;
            var url = 'https://api.openweathermap.org/data/2.5/weather?lat=' + lat + '&lon=' + lon + '&units=metric&appid=f9fa5864acceeac1881e98d5f989a59a';
            fetch(url)
              .then(response => response.json())
              .then(data => {
                var widget = document.getElementById('weather-widget');
                widget.innerHTML = 'El clima en ' + data.name + ' es ' + data.weather[0].description + ' y la temperatura es ' + data.main.temp + '°C';
              })
              .catch(error => console.error(error));
          });
        }
        window.addEventListener('load', getWeatherByLocation);
      </script>
    </div>
        
      
  </footer>
  <style>
    .hidden {
      display: none;
    }
  </style>

  <script>
    const loadMoreBtn = document.getElementById("load-more-btn");
    const productsContainer = document.getElementById("products-container");
    const productCards = productsContainer.getElementsByClassName("col-4");

    let visibleProducts = 3;
    if (productCards.length <= 3) {
      loadMoreBtn.style.display = "none";
    }


    loadMoreBtn.addEventListener("click", () => {
      let hiddenProducts = 0;
      for (let i = visibleProducts; i < visibleProducts + 3 && i < productCards.length; i++) {
        productCards[i].classList.remove("hidden");
        hiddenProducts++;
      }
      visibleProducts += hiddenProducts;

      if (visibleProducts >= productCards.length) {
        loadMoreBtn.style.display = "none";
      }
    });
  </script>


  <script>
    $(document).ready(function () {
        $('.btn-primary').click(function () {
            var prodId = $(this).data('prod-id');
            var url = "{% url 'product_detail' 'prod_id_placeholder' %}".replace('prod_id_placeholder', prodId);
            $.get(url, function (data) {
                $('#productModalBody').html(data);
            });
        });
    });
</script>




  <!--Boostrap JS-->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
    crossorigin="anonymous"></script>
</body>

</html>